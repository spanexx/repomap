{
  "milestone": {
    "number": "1.2",
    "title": "CLI Framework & Integration",
    "phase": "Phase-1-Foundation-MVP",
    "objective": "Extract and generalize reusable CLI patterns from repomap into a shared framework for all agent tools",
    "status": "in-progress",
    "timeline": {
      "start_date": "TBD",
      "end_date": "TBD",
      "estimated_duration_weeks": 1,
      "critical_path": [
        "CLI Framework Base",
        "Flag Parsing",
        "Output Formatters",
        "Configuration Management",
        "Repomap Refactoring",
        "Integration Testing"
      ]
    },
    "deliverables": [
      "CLI Framework Package (pkg/cli/)",
      "Output Formatter Package (pkg/output/)",
      "Configuration Manager Package (pkg/config/)",
      "Error Handling Package (pkg/errors/)",
      "Utilities Package (pkg/util/)",
      "Framework Documentation (FRAMEWORK_GUIDE.md, EXAMPLES.md, BEST_PRACTICES.md)",
      "Refactored Repomap using framework",
      "Unit tests (>80% coverage)",
      "Integration tests"
    ],
    "success_criteria": [
      "CLI framework is reusable by 2+ future tools",
      "All output formatters work with any tool's data structure",
      "Configuration hierarchy works (defaults → env → config → flags)",
      "Error handling is consistent across all tools",
      "Framework documentation is clear and includes examples",
      "Refactored repomap uses framework without losing functionality",
      "No breaking changes to repomap CLI interface",
      ">80% code coverage on framework packages",
      "Framework adds <10% overhead to CLI startup time"
    ],
    "technical_details": {
      "language": "Go",
      "minimum_version": "1.19",
      "packages": {
        "pkg/cli": "CLI framework (app, flags, help)",
        "pkg/output": "Output formatters (XML, JSON, text)",
        "pkg/config": "Configuration management",
        "pkg/errors": "Error types and codes",
        "pkg/util": "Shared utilities (paths, tokens, filtering, logging)"
      },
      "dependencies": [
        "Milestone 1.1: Repomap Core (for patterns)"
      ]
    },
    "task_summary": {
      "total_tasks": 22,
      "framework_foundation": 3,
      "output_formatting": 5,
      "configuration": 3,
      "error_handling": 2,
      "utilities": 4,
      "integration_refactoring": 2,
      "testing_validation": 3
    },
    "dependencies": {
      "external": [
        "Go 1.19+ compiler",
        "Standard library"
      ],
      "internal": [
        "Milestone 1.1 (Repomap Core) - for reference patterns"
      ],
      "blocking": []
    },
    "risks": [
      {
        "risk": "Over-engineering the framework for all possible future needs",
        "mitigation": "Keep it simple; only generalize what's actually needed; design for extensibility"
      },
      {
        "risk": "Breaking repomap during refactoring",
        "mitigation": "Use comprehensive testing; refactor incrementally with feature flags if needed"
      },
      {
        "risk": "Framework doesn't fit future tools",
        "mitigation": "Document patterns clearly; make framework extensible; test with stub implementations"
      }
    ],
    "success_metrics": {
      "framework_reusability": "Used by 2+ tools in Phase 2",
      "code_coverage": ">80% on framework packages",
      "performance_overhead": "<10% startup time increase",
      "api_stability": "No breaking changes in Phase 2+"
    }
  },
  "tasks": [
    {
      "id": "1.2.1",
      "title": "CLI Framework Base Package",
      "description": "Create pkg/cli/ package structure; Define App struct; Implement NewApp; Write unit tests",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.2",
      "title": "Flag Parsing Abstraction",
      "description": "Create flags.go with Flags struct; Implement AddFlag, Parse; Support common flag types; Generate help text",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.3",
      "title": "Help Text Generation",
      "description": "Implement help.go with GenerateHelp; Format help text; Make help text customizable",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.4",
      "title": "Output Writer Interface",
      "description": "Define Writer interface; Create output.go with factory NewWriter",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.5",
      "title": "Reusable XML Formatter",
      "description": "Extract XML formatting logic; Create xml.go with XMLWriter; Generalize to handle any struct",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.6",
      "title": "Reusable JSON Formatter",
      "description": "Extract JSON formatting logic; Create json.go with JSONWriter; Generalize to handle any struct",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.7",
      "title": "Text/Table Formatter",
      "description": "Create text.go with TextWriter; Support table formatting; Support key-value output",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.8",
      "title": "Output Writer Factory",
      "description": "Implement formatter.go with smart factory; Route to correct formatter; Handle unknown formats",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.9",
      "title": "Configuration Loader",
      "description": "Create config/config.go with Config struct; Implement LoadConfig; Read .repomaprc etc.; Parse formats",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.10",
      "title": "Environment Variable Support",
      "description": "Implement env.go with GetEnv; Support tool-specific prefixes",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.11",
      "title": "Configuration Hierarchy",
      "description": "Implement hierarchy.go with merge logic; Apply defaults -> env -> config -> flags",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.12",
      "title": "Error Types & Codes",
      "description": "Create errors/errors.go with custom error types; Create codes.go with standardized exit codes",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.13",
      "title": "Error Message Templates",
      "description": "Create messages.go with standardized messages; Support templating",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.14",
      "title": "Path Utilities",
      "description": "Create util/paths.go with NormalizePath, IsAbsolutePath, MakeRelative",
      "status": "completed",
      "passes": true
    },
    {
      "id": "1.2.15",
      "title": "Token Counting Utilities",
      "description": "Create util/tokens.go with CountTokens",
      "status": "todo",
      "passes": false
    },
    {
      "id": "1.2.16",
      "title": "File Filtering Helpers",
      "description": "Create util/filter.go with FilterByExtension, ExcludeByPattern",
      "status": "todo",
      "passes": false
    },
    {
      "id": "1.2.17",
      "title": "Logging Abstraction",
      "description": "Create util/logging.go with logger interface; Implement stdout/stderr logging",
      "status": "todo",
      "passes": false
    },
    {
      "id": "1.2.18",
      "title": "Refactor Repomap to Use Framework",
      "description": "Update cmd/repomap to use pkg/cli, pkg/output, pkg/config, pkg/errors; Verify tests",
      "status": "todo",
      "passes": false
    },
    {
      "id": "1.2.19",
      "title": "Framework Documentation",
      "description": "Write FRAMEWORK_GUIDE.md, EXAMPLES.md, BEST_PRACTICES.md; Write godoc comments",
      "status": "todo",
      "passes": false
    },
    {
      "id": "1.2.20",
      "title": "Unit Tests (All Packages)",
      "description": "Achieve >80% code coverage on pkg/",
      "status": "todo",
      "passes": false
    },
    {
      "id": "1.2.21",
      "title": "Integration Tests",
      "description": "Test framework with repomap; Test with mock tools; Verify hierarchy",
      "status": "todo",
      "passes": false
    },
    {
      "id": "1.2.22",
      "title": "Framework Compatibility Tests",
      "description": "Run repomap tests after refactoring; Verify CLI interface unchanged; Benchmarks",
      "status": "todo",
      "passes": false
    }
  ],
  "affected_files": [
    "repomap/pkg/cli/cli.go",
    "repomap/pkg/cli/cli_test.go",
    "repomap/pkg/cli/flags.go",
    "repomap/pkg/cli/flags_test.go",
    "repomap/pkg/cli/help.go",
    "repomap/pkg/cli/help_test.go",
    "repomap/pkg/output/writer.go",
    "repomap/pkg/output/output.go",
    "repomap/pkg/output/output_test.go",
    "repomap/pkg/output/xml.go",
    "repomap/pkg/output/xml_test.go",
    "repomap/pkg/output/json.go",
    "repomap/pkg/output/json_test.go",
    "repomap/pkg/output/text.go",
    "repomap/pkg/output/text_test.go",
    "repomap/pkg/config/config.go",
    "repomap/pkg/config/config_test.go",
    "repomap/pkg/config/env.go",
    "repomap/pkg/config/env_test.go",
    "repomap/pkg/config/hierarchy.go",
    "repomap/pkg/config/hierarchy_test.go",
    "repomap/pkg/errors/errors.go",
    "repomap/pkg/errors/codes.go",
    "repomap/pkg/errors/messages.go",
    "repomap/pkg/errors/messages_test.go",
    "repomap/pkg/errors/errors_test.go",
    "repomap/pkg/util/paths.go",
    "repomap/pkg/util/paths_test.go"
  ],
  "affected_dependencies": []
}
