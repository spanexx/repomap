# Milestone 1.4: Planning & Intent Analysis

## Objective
Transform `repomap` from a purely reactive visualization tool into a proactive planning instrument. This milestone enables `repomap` to detect structural issues (duplication, circular dependencies) and validates architectural "intent" before code is written. It bridges the gap between high-level AI planning and low-level code implementation.

## Features

### 1. Planning Metadata Schema
Extend the core `FileNode` structure to support planning attributes:
- **Status**: Track if a module is `existing`, `planned`, or `modified`.
- **Intent**: A human-readable description of the module's purpose (extracted from godoc or a separate manifest).
- **Issues**: A list of detected architectural violations.
- **Comments**: Collaborative feedback.

### 2. Static Analysis for Planning
Implement analyses to detect:
- **Duplicate Logic**: Identify functions or blocks with high similarity (using token-based fingerprinting or AST hashing).
- **Intention Overrides**: Allow developers to define a `.repomapintent` or similar config to specify architectural constraints (e.g., "Module A must not import Module B").
- **DRY Violations**: Flag repeated code structures.

### 3. Plan Ingestion & Validation
- **Input Plan**: Ability to ingest a `plan.json` generated by an AI planner.
- **Validation**: Compare `plan.json` against the current codebase graph.
- **Output**: Generate a `planned_repomap.json` that merges current state with planned changes for visualization.

## Technical Components

- **New Package**: `internal/planning`
  - `Schema`: Updated `FileNode` with planning fields.
  - `Analyzer`: Static analysis engine for duplication/DRY.
  - `Validator`: Logic to check graph against intent constraints.
- **CLI Updates**:
  - `repomap --plan <file>`: Load a plan.
  - `repomap --analyze`: Run static analysis and populate `issues`.

## Success Criteria
- ✅ `repomap` can ingest a `plan.json` and merging it with the scanned repo.
- ✅ CLI reports duplication/DRY warnings in JSON output.
- ✅ Visualization UI (from previous work) correctly displays intent, status, and issues.
- ✅ AI Agents can query `repomap` to validate their proposed architecture before writing code.
